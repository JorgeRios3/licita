{% extends "account_base.html" %}
{% load formats %}

{% block account_title %}Mi portal{% endblock %}

{% block account_header %}
{% endblock %}

{% block account_content %}
<button id="modal_boton" style="display:none" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
  Launch demo modal
</button>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title baloo-font" id="exampleModalLabel">Borrar Filtro</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body avenir-font">
        Seguro que quieres borrar el filtro
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary gray-button" data-dismiss="modal">No</button>
        <button type="button" class="btn btn-danger orange-light-button" onClick="aceptar_borrar_filtro()">Eliminar</button>
      </div>
    </div>
  </div>
</div>


<div class="container">
  <div class="row" style="margin-bottom: 50px;">
    <div class="col text-center baloo-font" style="font-size: 4.5em; font-weight: 900;">
    Configurac<span style="color:rgb(241,90,36)">i</span>ón
    </div>
  </div>
  <div class="row" style="margin-top:180px">
    <a class="btn btn-primary" style="text-decoration:none;" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
      Filtros
    </a>
    <div>&nbsp;&nbsp;&nbsp;&nbsp;</div>
    <a class="btn btn-primary" style="text-decoration:none;" data-toggle="collapse" href="#collapseusuarios" role="button" aria-expanded="false" aria-controls="collapseusuarios">
      Usuarios
    </a>
    <div>&nbsp;&nbsp;&nbsp;&nbsp;</div>
    <a class="btn btn-primary" style="text-decoration:none;" data-toggle="collapse" href="#collapsecuenta" role="button" aria-expanded="false" aria-controls="collapsecuenta">
      Cuenta
    </a>
    <div>&nbsp;&nbsp;&nbsp;&nbsp;</div>
    <a class="btn btn-primary" style="text-decoration:none;" data-toggle="collapse" href="#collapsepermisos" role="button" aria-expanded="false" aria-controls="collapsecuenta">
      Permisos
    </a>
  </div>
  {% if errors %}
  <ul>
    {% for x in errors %}
    <li>
      {{x}}
    </li>
    {% endfor %}
  </ul>
  {% endif %}
  <div class="collapse" id="collapsepermisos" style="padding-top:40px">
    <div class="row">
      <div class="col-sm-12 col-md-4" style="margin-bottom: 10px;">
        <div class="col" id="comprador_container">
          <div class="col">
            <table id="tabla_permisos" class="table">
              <thead>
                <tr>
                  <th scope="col">Usuario</th>
                  <th scope="col">Permiso</th>
                  <th scope="col">Acción</th>
                </tr>
              </thead>
              <tbody>
                {% for x in permisos_usuarios %}
                <tr>
                  <td>{{x.usuario}}</td>
                  <td>{{x.permiso.nombre}}</td>
                  <td><div class="btn btn-danger" onClick="DeletePermisionUser({{x.id}})">Borrar</div></td>
                </tr>
                {% endfor %}
                <tr>
                  <td><select onchange="validate_selection(this)" style="border-radius:5px; background-color:rgb(32,42,50); color:white;border-radius:5px; background-color:rgb(32,42,50); color:white; padding-right:20px; border-radius:5px; background-color:rgb(32,42,50); color:white; padding-left:10px" id="selected_usuario">
                    <option value="">Selecciona Usuario</option>
                    {% for x in usuarios %}
                    <option value="{{x.id}}">{{x}}</option>
                    {% endfor %}
                  </select></td>
                  <td>
                    <select onchange="validate_selection()" style="border-radius:5px; background-color:rgb(32,42,50); color:white;border-radius:5px; background-color:rgb(32,42,50); color:white; border-radius:5px; background-color:rgb(32,42,50); color:white; padding-left:10px" id="selected_permiso">
                      <option value="">Selecciona Permiso</option>
                    {% for x in permisos %}
                    <option value="{{x.id}}">{{x.nombre}}</option>
                    {% endfor %}
                  </select>
                  </td>
                  <td><div id="btn_agregar_permiso" onClick="agregar_permisoUsuario()" class="btn btn-info hide_add_permiso">Agregar</div></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <hr/>
  </div>
  <div class="collapse" id="collapsecuenta" style="padding-top:40px">
    <div class="row">
      <div class="col-sm-12 col-md-4" style="margin-bottom: 10px;">
        <div class="col" id="comprador_container">
          <div class="col">
            <!--
              admin_user = models.CharField(max_length=100, blank=True, null=True)
    company = models.CharField(max_length=50, blank=True, null=True)
    subscription_id = models.CharField(max_length=50, blank=True, null=True)
    plan_is_active = models.BooleanField(default=False)
    users = models.JSONField(default='{}')
    status = models.CharField(max_length=50, blank=True, null=True)
    subscription_type =models.CharField(max_length=50, blank=True, null=True)
            -->
              <div class="form-group">
                  <label for="exampleInputEmail1" class="avenir-font">Nombre</label>
                  {% if group.company %}
                  <input type="email" class="form-control basic-input" id="comprador_nombre" aria-describedby="emailHelp" placeholder="Nombre" value="{{group.company}}">
                  {% else %}
                  <input type="email" class="form-control basic-input" id="comprador_nombre" aria-describedby="emailHelp" placeholder="Nombre">
                  {% endif %}
              </div>
          </div>
          <div class="col">
              <div class="form-group">
                  <label for="exampleInputEmail1" class="avenir-font">Subscripcion Estatus</label>
                  {% if group.plan_is_active %}
                  <input type="email" class="form-control basic-input" id="comprador_email" aria-describedby="emailHelp" placeholder="Email" value="Activa" disabled>
                  {% else %}
                  <input type="email" class="form-control basic-input" id="comprador_email" aria-describedby="emailHelp" placeholder="Email" value="Inactiva" disabled>
                  {% endif %}
              </div>
          </div>
          <div class="col">
              <div class="form-group">
                  <label for="exampleInputEmail1" class="avenir-font">Plan</label>
                  {% if group.subscription_type %}
                  <input type="email" class="form-control basic-input" id="comprador_direccion" aria-describedby="emailHelp" placeholder="Direccion" value="{{group.subscription_type}}" disabled>
                  {% endif %}
              </div>
          </div>
          <div class="col">
              <div class="btn btn-secondary orange-button" style="margin-bottom: 50px; font-size:1.4em; height: 38px;" id="guardar_datos_comprador" onClick="guardar_datos_comprador({{id}})">Guardar</div>
          </div>
          <div class="col">
            {% if is_admin %}
            <a href="/account/borrar_cuenta">Borrar Cuenta</a>
            {% endif %}
        </div>
        </div>
      </div>
    </div>
    <hr/>
  </div>
  <div class="collapse" id="collapseusuarios" style="padding-top:40px">
    <div class="row">
      <div class="col-sm-12 col-md-4" style="margin-bottom: 10px;">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Usuario</th>
              <th scope="col">Nombre</th>
              <th scope="col">Apellido</th>
              <th scope="col">Correo</th>
              <th scope="col">Acción</th>
            </tr>
          </thead>
          <tbody>
            {% for x in usuarios %}
            <tr>
              <td>{{x.username}}</td>
              <td>{{x.first_name}}</td>
              <td>{{x.last_name}}</td>
              <td>{{x.email}}</td>
              <td>{% if group.admin_user != x.id %} <div class="btn btn-danger" onClick="deleteGroupUser({{x.id}})">Borrar</div>{% else %} <span>Administrador</span>{% endif %}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div id="" class="btn btn-info" data-toggle="collapse" href="#collapsecrearUsuario">Crear Usuario</div>
        <br/>
        <div class="collapse" id="collapsecrearUsuario">
          <form action="/group/add_user" method="post">
            {% csrf_token %}
            <div class="row">
              <div class="col-6">
                <div class="form-group">
                  <label for="exampleInputEmail1">Usuario</label>
                  {{ form.visible_fields.0 }}
                  <div class="help-block with-errors"></div>
                  {% for error in form.visible_fields.0.errors %}
                      <span class="help-block">{{ error }}</span>
                  {% endfor %}
              </div>
              </div>
              <div class="col-6">
                <div class="form-group">
                  <label for="exampleInputEmail1">Nombre</label>
                  {{ form.visible_fields.1 }}
                  <div class="help-block with-errors"></div>
                  {% for error in form.visible_fields.1.errors %}
                      <span class="help-block">{{ error }}</span>
                  {% endfor %}
              </div>
                
              </div>
            </div>
            <div class="row">
              <div class="col-6">
                <div class="form-group">
                  <label for="exampleInputEmail1">Apellido</label>
                  {{ form.visible_fields.2 }}
                  <div class="help-block with-errors"></div>
                  {% for error in form.visible_fields.2.errors %}
                      <span class="help-block">{{ error }}</span>
                  {% endfor %}
              </div>
              </div>
              <div class="col-6">
                <div class="form-group">
                  <label for="exampleInputEmail1">Email</label>
                  {{ form.visible_fields.3 }}
                  <div class="help-block with-errors"></div>
                  {% for error in form.visible_fields.3.errors %}
                      <span class="help-block">{{ error }}</span>
                  {% endfor %}
              </div>
                
              </div>
            </div>
            <div class="row">
              <div class="col-6">
                <div class="form-group">
                  <label for="exampleInputEmail1">Contraseña</label>
                  {{ form.visible_fields.4 }}
                  <div class="help-block with-errors"></div>
                  {% for error in form.visible_fields.4.errors %}
                      <span class="help-block">{{ error }}</span>
                  {% endfor %}
              </div>
              </div>

            </div>       
            <button type="submit" class="btn btn-dark orange-button" style="height:35px!important; width:120px!important;">Crear</button>
        </form>

        </div>
      </div>
    </div>
    <hr/>
  </div>
  <div class="collapse show" id="collapseExample">
    <div class="row">
      <div class="col-sm-12 col-md-4" style="margin-bottom: 10px;">
      <label><b class="baloo-font" style="font-size:1.4em; padding-left: 10px;">Grupo</b></label>
        <input class="form-control grupoAutoComplete basic-input" type="text" autocomplete="off" placeholder="Ingresa el grupo">
      </div>
      <div class="col-sm-12 col-md-3" style="margin-bottom: 10px;">
          <label><b class="baloo-font" style="font-size:1.4em; padding-left: 10px;">Familia</b></label>
          <input class="form-control familiaAutoComplete basic-input" type="text" autocomplete="off" placeholder="Ingresa la familia">
      </div>
      <div class="col-sm-12 col-md-3" style="margin-bottom: 10px;">
          <label><b class="baloo-font" style="font-size:1.4em; padding-left: 10px;">Articulo</b></label>
          <input class="form-control articuloAutoComplete basic-input" type="text" autocomplete="off" placeholder="Ingresa el artiulo">
      </div>
      <div class="col-sm-4 col-md-2" style="padding-top: 30px;">
        <button class="btn btn-info orange-button hide-element" id="add_filtro_btn" onClick="add_filtro()">Agregar Filtro</button>
      </div>
  </div>
  <div class="row">
    <div class="col-4">
        <form>
            <div class="form-group">
            <label for="exampleInputEmail1" style="font-size:1.3em !important; padding-left: 10px;" class="avenir-font">Buscar Filtro</label>
            <input id="search_filtro_valor" type="email" class="form-control basic-input" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Nombre Licitacion" onkeyup="keyupFunction_buscar_filtro()">
            </div>
        </form>
    </div>

    {% if items_qty %}
    <div class="col-3">
        <br><br>
        <form>
            <div class="form-group">
                <span style="font-weight: bold;">Licitaciones Encontradas {{items_qty}}</span>
            </div>
        </form>
    </div>
    {% endif %}

  </div>

  <br><br>
<div class="row" id="filtros_container">
    <div class="col">
        <p><b class="baloo-font" style="font-size:1.6em">Filtros seleccionados:</b></p>
        <div id="tabla_filtros">
        <table class="table">
            <thead>
              <tr>
                <th scope="col" class="table-titles">Grupo</th>
                <th scope="col" class="table-titles">Familia</th>
                <th scope="col" class="table-titles">Articulo</th>
                <th scope="col" class="table-titles">Estatus</th>
              </tr>
            </thead>
            <tbody>
              {% for x in filtros %}
              <tr>
                <th scope="row" class="baloo-font" style="font-size:1.1em">{{x.grupo|empty_val}}</th>
                <td class="baloo-font" style="font-size:1.1em">{{x.familia|empty_val}}</td>
                <td class="baloo-font" style="font-size:1.1em">{{x.articulo|empty_val}}</td>
                <td><div class="dropdown">
                  {% if x.activado %}
                  {% if request.user.id|user_has_permission:"administrador,gerente,editarFiltros" %}
                  <button class="btn btn-info dropdown-toggle baloo-font" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Activo
                  </button>
                  {% else %}
                  <div>Activo</div>
                  {% endif %}
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item baloo-font" onClick="change_status_filtro({{x.id}}, 'Desactivar')" >Desactivar</a>
                    <a class="dropdown-item baloo-font" onClick="change_status_filtro({{x.id}}, 'Eliminar')">Eliminar</a>
                  </div>
                  {% else %}
                  {% if request.user.id|user_has_permission:"administrador,gerente,editarFiltros" %}
                  <button class="btn btn-danger dropdown-toggle baloo-font" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Inactivo
                  </button>
                  {% else %}
                  <div>Inactivo</div> 
                  {% endif %}
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item baloo-font" onClick="change_status_filtro({{x.id}}, 'Activar')">Activar</a>
                    <a class="dropdown-item baloo-font" onClick="change_status_filtro({{x.id}}, 'Eliminar')">Eliminar</a>
                  </div>
                  {% endif %}
                </div></td>        
              </tr>
              {% endfor %}
            </tbody>
          </table>
          </div>
    </div>
    <div class="divider"></div>
</div>


</div>
<!-- end of row -->
</div>
{% endblock %}
